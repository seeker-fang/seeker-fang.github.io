<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>SMC | Born to Shine</title><meta name="author" content="第二支羽毛"><meta name="copyright" content="第二支羽毛"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="SMC什么是SMCSMC（Self Modified Code），也就是自修改代码。它是在执行过程中修改自身指令的代码或数据，来组织别人直接静态分析，然后在动态运行程序时对代码进行解密，达到程序正常运行的效果。 VirtualProtect 函数通常用于代码自加密的场景。代码自加密是一种保护代码不被轻易逆向分析的技术，通过在程序运行时动态地修改代码的内存保护属性，使得代码在执行时可以被修改和执行，">
<meta property="og:type" content="article">
<meta property="og:title" content="SMC">
<meta property="og:url" content="http://example.com/2025/07/21/SMC/index.html">
<meta property="og:site_name" content="Born to Shine">
<meta property="og:description" content="SMC什么是SMCSMC（Self Modified Code），也就是自修改代码。它是在执行过程中修改自身指令的代码或数据，来组织别人直接静态分析，然后在动态运行程序时对代码进行解密，达到程序正常运行的效果。 VirtualProtect 函数通常用于代码自加密的场景。代码自加密是一种保护代码不被轻易逆向分析的技术，通过在程序运行时动态地修改代码的内存保护属性，使得代码在执行时可以被修改和执行，">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/seeker-fang/Images//202502222116882.png">
<meta property="article:published_time" content="2025-07-21T13:19:47.000Z">
<meta property="article:modified_time" content="2025-07-21T12:25:56.590Z">
<meta property="article:author" content="第二支羽毛">
<meta property="article:tag" content="SMC">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/seeker-fang/Images//202502222116882.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "SMC",
  "url": "http://example.com/2025/07/21/SMC/",
  "image": "https://cdn.jsdelivr.net/gh/seeker-fang/Images//202502222116882.png",
  "datePublished": "2025-07-21T13:19:47.000Z",
  "dateModified": "2025-07-21T12:25:56.590Z",
  "author": [
    {
      "@type": "Person",
      "name": "第二支羽毛",
      "url": "http://example.com/"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2025/07/21/SMC/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":50,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'SMC',
  isHighlightShrink: true,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="https://cdn.jsdelivr.net/gh/seeker-fang/Images//202502222128421.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">16</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">9</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 链接</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://cdn.jsdelivr.net/gh/seeker-fang/Images//202502222116882.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Born to Shine</span></a><a class="nav-page-title" href="/"><span class="site-name">SMC</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 链接</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></li></ul></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">SMC</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-07-21T13:19:47.000Z" title="发表于 2025-07-21 21:19:47">2025-07-21</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-07-21T12:25:56.590Z" title="更新于 2025-07-21 20:25:56">2025-07-21</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0/">逆向学习</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="SMC"><a href="#SMC" class="headerlink" title="SMC"></a>SMC</h1><h2 id="什么是SMC"><a href="#什么是SMC" class="headerlink" title="什么是SMC"></a>什么是SMC</h2><p><strong>SMC</strong>（Self Modified Code），也就是自修改代码。它是在执行过程中修改自身指令的代码或数据，来组织别人直接静态分析，然后在动态运行程序时对代码进行解密，达到程序正常运行的效果。</p>
<p><strong>VirtualProtect 函数</strong>通常用于代码自加密的场景。代码自加密是一种保护代码不被轻易逆向分析的技术，通过在程序运行时动态地修改代码的内存保护属性，使得代码在执行时可以被修改和执行，但在不执行时则不能被读取或修改。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">BOOL <span class="title">VirtualProtect</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">  LPVOID lpAddress,           <span class="comment">// 要修改的内存起始地址</span></span></span></span><br><span class="line"><span class="params"><span class="function">  SIZE_T dwSize,              <span class="comment">// 要修改的字节数</span></span></span></span><br><span class="line"><span class="params"><span class="function">  DWORD  flNewProtect,        <span class="comment">// 新的保护属性</span></span></span></span><br><span class="line"><span class="params"><span class="function">  PDWORD lpflOldProtect       <span class="comment">// 原始保护属性（输出）</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>;</span><br></pre></td></tr></table></figure>

<p>它的作用是：修改指定内存区域的访问权限（如改为可读写可执行），并返回之前的保护属性。这是在Windows程序里。</p>
<p><strong>mprotect()函数</strong>是在<code>Linux</code> 程序中来改变虚拟内存区域的属性的。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/mman.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">mprotect</span><span class="params">(<span class="type">void</span> *addr, <span class="type">size_t</span> len, <span class="type">int</span> prot)</span>;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>参数</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td><code>addr</code></td>
<td>要修改保护属性的内存区域起始地址（必须是页对齐的）</td>
</tr>
<tr>
<td><code>len</code></td>
<td>要修改的内存长度（会按页大小对齐）</td>
</tr>
<tr>
<td><code>prot</code></td>
<td>新的保护属性（如下表）</td>
</tr>
</tbody></table>
<p>这些可以组合使用，例如<code>PROT_READ | PROT_WRITE</code> 表示可读可写。</p>
<table>
<thead>
<tr>
<th>宏名</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td><code>PROT_NONE</code></td>
<td>无访问权限</td>
</tr>
<tr>
<td><code>PROT_READ</code></td>
<td>可读取</td>
</tr>
<tr>
<td><code>PROT_WRITE</code></td>
<td>可写入</td>
</tr>
<tr>
<td><code>PROT_EXEC</code></td>
<td>可执行</td>
</tr>
</tbody></table>
<p>在程序中如果发现VirtualProtect 函数或mprotect()函数，那么极有可能是SMC。</p>
<p>SMC一般有两种破解方法。</p>
<p><strong>第一种</strong>是<strong>找到对代码或数据加密的函数</strong>后通过idapython写解密脚本。</p>
<p><strong>第二种</strong>是<strong>动态调试</strong>到SMC解密结束的地方dump出来。</p>
<h2 id="例题"><a href="#例题" class="headerlink" title="例题"></a>例题</h2><h3 id="1-NSS-网鼎杯-2020-青龙组-jocker"><a href="#1-NSS-网鼎杯-2020-青龙组-jocker" class="headerlink" title="1.NSS-[网鼎杯 2020 青龙组]jocker"></a>1.NSS-[网鼎杯 2020 青龙组]jocker</h3><p>使用IDA打开后，我们进行分析，发现整个函数头有<code>positive sp value has been detected, the output may be wrong!</code></p>
<p>这就说明了存在栈不平衡的问题，导致IDA无法生成代码，我们可以在IDA里打开栈指针<strong>Options-&gt;General-&gt;Stack pointer</strong>来帮助分析。在x64架构里<code>rsp</code> 是栈指针，它总是指向当前栈顶，在x86架构里<code>esp</code>是栈指针。</p>
<p><img src="https://cdn.jsdelivr.net/gh/seeker-fang/Images//202507181857168.png"></p>
<p>会发现有<code>VirtualProtect 函数</code>，那么这个大概率就是一个smc了。先进行分析，也就是要输入一个24位的flag，然后通过wrong(flag)进行加密，再通过omg(flag)进行比较，先看看加密函数。</p>
<img src="https://cdn.jsdelivr.net/gh/seeker-fang/Images//202507181900314.png" style="zoom:80%;" />

<p>这个加密逻辑很简单，就是分出奇偶分别进行加密。</p>
<img src="https://cdn.jsdelivr.net/gh/seeker-fang/Images//202507181856924.png" style="zoom: 67%;" />

<p>这个检验逻辑也很简单，我们可以直接从unk_4030C0中读取出来。</p>
<img src="https://cdn.jsdelivr.net/gh/seeker-fang/Images//202507181902092.png" style="zoom:50%;" />

<p>需要注意的是它是24个int型的数据，读取之后写出exp，但是是错误的</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">v2=[<span class="number">0x66</span>, <span class="number">0x6B</span>, <span class="number">0x63</span>, <span class="number">0x64</span>, <span class="number">0x7F</span>, <span class="number">0x61</span>, <span class="number">0x67</span>, <span class="number">0x64</span>, <span class="number">0x3B</span>, <span class="number">0x56</span>, <span class="number">0x6B</span>, <span class="number">0x61</span>, <span class="number">0x7B</span>, <span class="number">0x26</span>, <span class="number">0x3B</span>, <span class="number">0x50</span>, <span class="number">0x63</span>, <span class="number">0x5F</span>, <span class="number">0x4D</span>, <span class="number">0x5A</span>, <span class="number">0x71</span>, <span class="number">0x0C</span>, <span class="number">0x37</span>, <span class="number">0x66</span>]</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(v2))</span><br><span class="line">flag=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(v2)):</span><br><span class="line">    <span class="keyword">if</span>((i&amp;<span class="number">1</span>)!=<span class="number">0</span>):</span><br><span class="line">        flag+=<span class="built_in">chr</span>(v2[i]+i)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        flag+=<span class="built_in">chr</span>(v2[i]^i)    </span><br><span class="line"><span class="built_in">print</span>(flag)       </span><br><span class="line"><span class="comment">#flag&#123;fak3_alw35_sp_me!!&#125; </span></span><br></pre></td></tr></table></figure>

<p>就是说嘛，这个是SMC，不会这么简单的。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( !<span class="built_in">VirtualProtect</span>(encrypt, <span class="number">0xC8u</span>, <span class="number">4u</span>, &amp;flOldProtect) )</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br></pre></td></tr></table></figure>

<p>意思是：将 <code>encrypt</code> 函数所在的内存区域设置为 <code>PAGE_READWRITEEXECUTE</code>（值是 4），允许后续对其进行修改。<code>0xC8</code> 是要修改的字节长度，即 200 字节。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">186</span>; ++i )</span><br><span class="line">    *((_BYTE *)encrypt + i) ^= <span class="number">0x41</span>u;</span><br></pre></td></tr></table></figure>

<p>作用是：<strong>运行时对 <code>encrypt</code> 函数做 XOR 解密</strong>，之前程序通过 XOR 将 <code>encrypt</code> 加密存储，这里要先“解锁”。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( <span class="built_in">encrypt</span>(Destination) )</span><br><span class="line">    <span class="built_in">sub_40159A</span>(Destination);</span><br></pre></td></tr></table></figure>

<p>这才是真正验证flag的代码。</p>
<p>我们可以在<code>if ( encrypt(Destination) )</code>这里下断点，然后动态调试看真正的加密方式。动态调试时，会提示我们输入flag，这里任意输只要长度是24就好了。然后直接查看汇编，找到encrypt函数是public __Z7encryptPc</p>
<p>点进去发现，IDA反汇编错误，下面有很大串的数据都没识别出来，我们就将函数头按U解除定义，然后从函数头一直选到0x00401630这里结束，按C让IDA强制重新解析成代码。</p>
<p><img src="https://cdn.jsdelivr.net/gh/seeker-fang/Images//202507182007028.png"></p>
<p>这样就好了，然后再在函数头按P进行重新定义</p>
<p><img src="https://cdn.jsdelivr.net/gh/seeker-fang/Images//202507182010880.png"></p>
<p>然后F5就能反编译了。下一个函数 loc_40159A也没有办法反编译，就在函数头0x0040159A处，U解除定义，再P重新定义一下就能反编译了。</p>
<p><img src="https://cdn.jsdelivr.net/gh/seeker-fang/Images//202507182013033.png"></p>
<p>这就是真正的加密函数了，分析一下，右边的是将flag[i]和Buffer[i]进行异或得到密文v2[i],我们可以从unk_403040处找到v2密文，也能直接点击Buffer得到这个字符串是<code>&#39;hahahaha_do_you_find_me?&#39;</code>，那么我们就能得到前19位的flag，只要将v2[i]和Buffer[i]进行异或就好了。我们知道这个flag一共是24位，还有5位不知道，看左边的加密函数。这个v3密文正好是5位，但是这个函数并没有什么卵用，我们就进行猜测这个是flag与某个值进行异或得到了这个密文。已知flag最后一位一定是右括号”}”，那么我们将这个和密文异或就能得到某个值了。</p>
<p>写出exp</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">buffer=<span class="string">&#x27;hahahaha_do_you_find_me?&#x27;</span></span><br><span class="line">flag =<span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">v2=[<span class="number">0x0E</span>, <span class="number">0x0D</span>, <span class="number">0x09</span>, <span class="number">0x06</span>, <span class="number">0x13</span> ,<span class="number">0x05</span> ,<span class="number">0x58</span> ,<span class="number">0x56</span> ,<span class="number">0x3E</span> ,<span class="number">0x06</span> ,<span class="number">0x0C</span> ,<span class="number">0x3C</span> ,<span class="number">0x1F</span> ,<span class="number">0x57</span> ,<span class="number">0x14</span> ,<span class="number">0x6B</span> ,<span class="number">0x57</span> ,<span class="number">0x59</span> ,<span class="number">0x0D</span> ] </span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(v2))  </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(v2)):</span><br><span class="line">    flag+= <span class="built_in">chr</span>(v2[i]^<span class="built_in">ord</span>(buffer[i]))</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"></span><br><span class="line">v3 =<span class="string">&#x27;%tp&amp;:&#x27;</span></span><br><span class="line">a=<span class="built_in">ord</span>(<span class="string">&#x27;:&#x27;</span>)^<span class="built_in">ord</span>(<span class="string">&#x27;&#125;&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(v3)):</span><br><span class="line">    flag+=<span class="built_in">chr</span>(<span class="built_in">ord</span>(v3[i])^a)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"></span><br><span class="line"><span class="comment">#flag&#123;d07abccf8a410c</span></span><br><span class="line"><span class="comment">#flag&#123;d07abccf8a410cb37a&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-NSSRound-2-Able-findxenny"><a href="#2-NSSRound-2-Able-findxenny" class="headerlink" title="2.[NSSRound#2 Able]findxenny"></a>2.[NSSRound#2 Able]findxenny</h3><p>使用IDA打开程序后，找到main函数，进行分析</p>
<p><img src="https://cdn.jsdelivr.net/gh/seeker-fang/Images//202507210956825.png"></p>
<p>这个是将输入的flag放到v12里面，长度要大于等于12，并且将这个分成三份，分别放到v14，v15，v16里面。然后进入到一个函数里面，最后的if条件是进行检测判断，通过这三个函数来对flag的三部分进行检测。那我们要进入到<code>sub_140011514()</code>里面来看看它进行了什么操作，里面有没有关于这三个函数的信息。</p>
<p><img src="https://cdn.jsdelivr.net/gh/seeker-fang/Images//202507211013432.png"></p>
<p>发现了VirtualProtect 函数，这就说明了考察的是SMC，上面的数据都是加密后的，下面是解密的内容，我们可以通过动态调试的办法找到解密后的数据，最后的那三个函数就是main函数里进行校验flag的函数。我们在 <strong>qword_140029370</strong>， <strong>qword_140029378</strong>，<strong>qword_140029380</strong>都下上断点，进行调试。</p>
<p><img src="https://cdn.jsdelivr.net/gh/seeker-fang/Images//202507211018119.png"></p>
<p>只要输入大于等于12个字符就好了。</p>
<p>我们单步步入到 <strong>return</strong>处，然后点击这三个函数，会发现这里原本没有数据，这时候竟然有数据了</p>
<p><img src="https://cdn.jsdelivr.net/gh/seeker-fang/Images//202507211020658.png"></p>
<p>我们点进去后，光标原本所在的位置就是函数头，直接按P进行重新定义，然后F5，就能将这个函数编译出来。	</p>
<p><img src="https://cdn.jsdelivr.net/gh/seeker-fang/Images//202507211023481.png"></p>
<p><img src="https://cdn.jsdelivr.net/gh/seeker-fang/Images//202507211023116.png"></p>
<p>另外两个函数也是用这个相同的方法进行反编译，就能知道校验的内容。</p>
<p>第二个函数</p>
<p><img src="https://cdn.jsdelivr.net/gh/seeker-fang/Images//202507211025481.png"></p>
<p>第三个函数</p>
<p><img src="https://cdn.jsdelivr.net/gh/seeker-fang/Images//202507211026185.png"></p>
<p>我们会发现第三个将它反过来就是 _x3nny，与提示输入的xenny有异曲同工之妙，这三个内容应该就是flag的内容，但是第一个和第三个反了，将它们反过来后进行拼接就是flag。这一步主要靠经验和猜测。</p>
<p>最后flag就是<strong>NSSCTF{oh_you_found_our_x3nny}</strong></p>
<h3 id="3-NSS-HDCTF-2023-enc"><a href="#3-NSS-HDCTF-2023-enc" class="headerlink" title="3.NSS-[HDCTF 2023]enc"></a>3.NSS-[HDCTF 2023]enc</h3><p>放到IDA里面进行分析</p>
<p><img src="https://cdn.jsdelivr.net/gh/seeker-fang/Images//202507211122952.png"></p>
<p>这个题是两部分组成，第一部分通过TEA解密要找到密钥，输入密钥正确后，我们才能进入第二部分输入flag以及flag的验证。</p>
<p>发现<code>sub_411302(v6)</code>函数点开后不能正确的反编译。先看看TEA函数吧，<code>sub_411523((int)&amp;v7, (int)v9);</code>输入的key在TEA加密后必须输出<strong>v7 &#x3D;&#x3D; 1627184887  &#x2F;&#x2F; 0x610B6A77，v8 &#x3D;&#x3D; 37149676    &#x2F;&#x2F; 0x0235AC4C</strong>这两个特定数值，这是密文，利用它来解密，会得到两个数据，其中一个是v8&#x3D;4，那另外一个就是v7&#x3D;key了。</p>
<p><img src="https://cdn.jsdelivr.net/gh/seeker-fang/Images//202507211117829.png"></p>
<p>就是简单的TEA，进行解密</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">TEA_decrypt</span><span class="params">(<span class="type">uint32_t</span>* v, <span class="type">uint32_t</span>* k)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">uint32_t</span> v0 = v[<span class="number">0</span>], v1 = v[<span class="number">1</span>];</span><br><span class="line">    <span class="type">uint32_t</span> delta = <span class="number">0x61C88647</span>;</span><br><span class="line">    <span class="type">uint32_t</span> sum = -delta * <span class="number">32</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">32</span>; i++) &#123;</span><br><span class="line">        v1 -= (k[<span class="number">3</span>] + (v0 &gt;&gt; <span class="number">5</span>)) ^ (sum + v0) ^ (k[<span class="number">2</span>] + <span class="number">16</span> * v0);</span><br><span class="line">        v0 -= (k[<span class="number">1</span>] + (v1 &gt;&gt; <span class="number">5</span>)) ^ (sum + v1) ^ (k[<span class="number">0</span>] + <span class="number">16</span> * v1);</span><br><span class="line">        sum += delta;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    v[<span class="number">0</span>] = v0;</span><br><span class="line">    v[<span class="number">1</span>] = v1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">uint32_t</span> key[<span class="number">4</span>] = &#123;<span class="number">18</span>, <span class="number">52</span>, <span class="number">86</span>, <span class="number">120</span>&#125;;</span><br><span class="line">    <span class="type">uint32_t</span> cipher[<span class="number">2</span>] = &#123;<span class="number">1627184887</span>, <span class="number">37149676</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">TEA_decrypt</span>(cipher, key);</span><br><span class="line"></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Decrypted v0 = &quot;</span> &lt;&lt; cipher[<span class="number">0</span>] &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Decrypted v1 = &quot;</span> &lt;&lt; cipher[<span class="number">1</span>] &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//Decrypted v0 = 3</span></span><br><span class="line"><span class="comment">//Decrypted v1 = 4</span></span><br></pre></td></tr></table></figure>

<p>key等于3，我们在<code>sub_411302(v6)</code>函数处打上断点，进行动态调试。</p>
<p><img src="https://cdn.jsdelivr.net/gh/seeker-fang/Images//202507211128568.png"></p>
<p>我们在断点位置按F7进行单步步入看看汇编，发现与静态分析的有所不同，这里有很多数据都没有被正确识别出来</p>
<p><img src="https://cdn.jsdelivr.net/gh/seeker-fang/Images//202507211133975.png"></p>
<p>我们直接在函数头按P进行重新定义，让IDA重新识别。</p>
<p><img src="https://cdn.jsdelivr.net/gh/seeker-fang/Images//202507211134876.png"></p>
<p>然后按F5进行反编译，得到这个函数的内容了，进行分析。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> __cdecl __noreturn <span class="title">sub_41D000</span><span class="params">(<span class="type">char</span> *Str)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">char</span> v1; <span class="comment">// [esp+0h] [ebp-558h]</span></span><br><span class="line">  <span class="type">size_t</span> m; <span class="comment">// [esp+190h] [ebp-3C8h]</span></span><br><span class="line">  BOOL v3; <span class="comment">// [esp+19Ch] [ebp-3BCh]</span></span><br><span class="line">  <span class="type">int</span> k; <span class="comment">// [esp+1A8h] [ebp-3B0h]</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// [esp+1B4h] [ebp-3A4h]</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// [esp+1C0h] [ebp-398h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [esp+1CCh] [ebp-38Ch]</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [esp+1CCh] [ebp-38Ch]</span></span><br><span class="line">  <span class="type">int</span> v9; <span class="comment">// [esp+1CCh] [ebp-38Ch]</span></span><br><span class="line">  <span class="type">char</span> v10; <span class="comment">// [esp+1DBh] [ebp-37Dh]</span></span><br><span class="line">  <span class="type">char</span> v11; <span class="comment">// [esp+1DBh] [ebp-37Dh]</span></span><br><span class="line">  <span class="type">char</span> v12[<span class="number">540</span>]; <span class="comment">// [esp+1E4h] [ebp-374h]</span></span><br><span class="line">  <span class="type">char</span> v13[<span class="number">16</span>]; <span class="comment">// [esp+400h] [ebp-158h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v14; <span class="comment">// [esp+418h] [ebp-140h]</span></span><br><span class="line">  <span class="type">char</span> v15[<span class="number">264</span>]; <span class="comment">// [esp+424h] [ebp-134h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v16[<span class="number">40</span>]; <span class="comment">// [esp+52Ch] [ebp-2Ch] BYREF</span></span><br><span class="line"></span><br><span class="line">  __CheckForDebuggerJustMyCode(&amp;unk_425036);</span><br><span class="line">  v16[<span class="number">0</span>] = <span class="number">15</span>;</span><br><span class="line">  v16[<span class="number">1</span>] = <span class="number">-108</span>;</span><br><span class="line">  v16[<span class="number">2</span>] = <span class="number">-82</span>;</span><br><span class="line">  v16[<span class="number">3</span>] = <span class="number">-14</span>;</span><br><span class="line">  v16[<span class="number">4</span>] = <span class="number">-64</span>;</span><br><span class="line">  v16[<span class="number">5</span>] = <span class="number">87</span>;</span><br><span class="line">  v16[<span class="number">6</span>] = <span class="number">-62</span>;</span><br><span class="line">  v16[<span class="number">7</span>] = <span class="number">-32</span>;</span><br><span class="line">  v16[<span class="number">8</span>] = <span class="number">-102</span>;</span><br><span class="line">  v16[<span class="number">9</span>] = <span class="number">69</span>;</span><br><span class="line">  v16[<span class="number">10</span>] = <span class="number">55</span>;</span><br><span class="line">  v16[<span class="number">11</span>] = <span class="number">80</span>;</span><br><span class="line">  v16[<span class="number">12</span>] = <span class="number">-11</span>;</span><br><span class="line">  v16[<span class="number">13</span>] = <span class="number">-96</span>;</span><br><span class="line">  v16[<span class="number">14</span>] = <span class="number">94</span>;</span><br><span class="line">  v16[<span class="number">15</span>] = <span class="number">-53</span>;</span><br><span class="line">  v16[<span class="number">16</span>] = <span class="number">44</span>;</span><br><span class="line">  v16[<span class="number">17</span>] = <span class="number">22</span>;</span><br><span class="line">  v16[<span class="number">18</span>] = <span class="number">40</span>;</span><br><span class="line">  v16[<span class="number">19</span>] = <span class="number">41</span>;</span><br><span class="line">  v16[<span class="number">20</span>] = <span class="number">-2</span>;</span><br><span class="line">  v16[<span class="number">21</span>] = <span class="number">-1</span>;</span><br><span class="line">  v16[<span class="number">22</span>] = <span class="number">51</span>;</span><br><span class="line">  v16[<span class="number">23</span>] = <span class="number">70</span>;</span><br><span class="line">  v16[<span class="number">24</span>] = <span class="number">14</span>;</span><br><span class="line">  v16[<span class="number">25</span>] = <span class="number">87</span>;</span><br><span class="line">  v16[<span class="number">26</span>] = <span class="number">-126</span>;</span><br><span class="line">  v16[<span class="number">27</span>] = <span class="number">34</span>;</span><br><span class="line">  v16[<span class="number">28</span>] = <span class="number">82</span>;</span><br><span class="line">  v16[<span class="number">29</span>] = <span class="number">38</span>;</span><br><span class="line">  v16[<span class="number">30</span>] = <span class="number">43</span>;</span><br><span class="line">  v16[<span class="number">31</span>] = <span class="number">110</span>;</span><br><span class="line">  v16[<span class="number">32</span>] = <span class="number">-28</span>;</span><br><span class="line">  v16[<span class="number">33</span>] = <span class="number">-126</span>;</span><br><span class="line">  v16[<span class="number">34</span>] = <span class="number">36</span>;</span><br><span class="line">  <span class="built_in">j_memset</span>(v15, <span class="number">0</span>, <span class="number">0x100u</span>);</span><br><span class="line">  v14 = <span class="built_in">j_strlen</span>(Str);</span><br><span class="line">  <span class="built_in">strcpy</span>(v13, <span class="string">&quot;you_are_master&quot;</span>);</span><br><span class="line">  v12[<span class="number">531</span>] = <span class="number">0</span>;</span><br><span class="line">  v5 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">256</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    v12[i + <span class="number">264</span>] = i;</span><br><span class="line">    v12[i] = v13[i % <span class="built_in">j_strlen</span>(v13)];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; <span class="number">256</span>; ++j )</span><br><span class="line">  &#123;</span><br><span class="line">    v5 = ((<span class="type">unsigned</span> __int8)v12[j] + v5 + (<span class="type">unsigned</span> __int8)v12[j + <span class="number">264</span>]) % <span class="number">256</span>;</span><br><span class="line">    v10 = v12[j + <span class="number">264</span>];</span><br><span class="line">    v12[j + <span class="number">264</span>] = v12[v5 + <span class="number">264</span>];</span><br><span class="line">    v12[v5 + <span class="number">264</span>] = v10;</span><br><span class="line">  &#125;</span><br><span class="line">  v6 = <span class="number">0</span>;</span><br><span class="line">  v9 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( k = <span class="number">0</span>; k &lt; v14; ++k )</span><br><span class="line">  &#123;</span><br><span class="line">    v9 = (v9 + <span class="number">1</span>) % <span class="number">256</span>;</span><br><span class="line">    v6 = (v6 + (<span class="type">unsigned</span> __int8)v12[v9 + <span class="number">264</span>]) % <span class="number">256</span>;</span><br><span class="line">    v11 = v12[v9 + <span class="number">264</span>];</span><br><span class="line">    v12[v9 + <span class="number">264</span>] = v12[v6 + <span class="number">264</span>];</span><br><span class="line">    v12[v6 + <span class="number">264</span>] = v11;</span><br><span class="line">    v15[k] = v12[((<span class="type">unsigned</span> __int8)v12[v6 + <span class="number">264</span>] + (<span class="type">unsigned</span> __int8)v12[v9 + <span class="number">264</span>]) % <span class="number">256</span> + <span class="number">264</span>] ^ Str[k];</span><br><span class="line">  &#125;</span><br><span class="line">  v3 = <span class="built_in">j_strlen</span>(Str) == <span class="number">35</span>;</span><br><span class="line">  <span class="keyword">for</span> ( m = <span class="number">0</span>; m &lt; <span class="built_in">j_strlen</span>(v16); ++m )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( v16[m] != v15[m] )</span><br><span class="line">    &#123;</span><br><span class="line">      v3 = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( v3 )</span><br><span class="line">    <span class="built_in">sub_41114F</span>(<span class="string">&quot;right!!!!&quot;</span>, v1);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">sub_41114F</span>(<span class="string">&quot;please try agin~&quot;</span>, v1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这是标准的RC4对输入的flag进行加密，把加密后的结果v15与v16进行逐字节比较，如果完全匹配，就打印 <code>right!!!!</code>，那么v16就是密文了，密钥就是v13<code>&quot;you_are_master&quot;</code>。</p>
<p>我们可以使用在线网站进行解密：<a target="_blank" rel="noopener" href="https://www.toolhelper.cn/SymmetricEncryption/RC4">https://www.toolhelper.cn/SymmetricEncryption/RC4</a></p>
<p><img src="https://cdn.jsdelivr.net/gh/seeker-fang/Images//202507211142615.png"></p>
<p>也可以使用脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">rc4_decrypt</span>(<span class="params">ciphertext, key</span>):</span><br><span class="line">    <span class="comment"># Key-scheduling algorithm (KSA)</span></span><br><span class="line">    S = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">256</span>))</span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">        j = (j + S[i] + <span class="built_in">ord</span>(key[i % <span class="built_in">len</span>(key)])) % <span class="number">256</span></span><br><span class="line">        S[i], S[j] = S[j], S[i]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Pseudo-random generation algorithm (PRGA)</span></span><br><span class="line">    i = j = <span class="number">0</span></span><br><span class="line">    keystream = []</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(ciphertext)):</span><br><span class="line">        i = (i + <span class="number">1</span>) % <span class="number">256</span></span><br><span class="line">        j = (j + S[i]) % <span class="number">256</span></span><br><span class="line">        S[i], S[j] = S[j], S[i]</span><br><span class="line">        K = S[(S[i] + S[j]) % <span class="number">256</span>]</span><br><span class="line">        keystream.append(K)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Decrypt by XORing</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>([c ^ k <span class="keyword">for</span> c, k <span class="keyword">in</span> <span class="built_in">zip</span>(ciphertext, keystream)])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># Encrypted values (converted to unsigned 8-bit integers)</span></span><br><span class="line">    v16 = [</span><br><span class="line">        <span class="number">15</span>, <span class="number">148</span>, <span class="number">174</span>, <span class="number">242</span>, <span class="number">192</span>, <span class="number">87</span>, <span class="number">194</span>, <span class="number">224</span>, <span class="number">154</span>, <span class="number">69</span>,</span><br><span class="line">        <span class="number">55</span>, <span class="number">80</span>, <span class="number">245</span>, <span class="number">160</span>, <span class="number">94</span>, <span class="number">203</span>, <span class="number">44</span>, <span class="number">22</span>, <span class="number">40</span>, <span class="number">41</span>,</span><br><span class="line">        <span class="number">254</span>, <span class="number">255</span>, <span class="number">51</span>, <span class="number">70</span>, <span class="number">14</span>, <span class="number">87</span>, <span class="number">130</span>, <span class="number">34</span>, <span class="number">82</span>, <span class="number">38</span>,</span><br><span class="line">        <span class="number">43</span>, <span class="number">110</span>, <span class="number">228</span>, <span class="number">130</span>, <span class="number">36</span></span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    key = <span class="string">&quot;you_are_master&quot;</span></span><br><span class="line">    decrypted = rc4_decrypt(v16, key)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Recovered flag:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(decrypted.decode())</span><br></pre></td></tr></table></figure>

<h3 id="4-NSS-羊城杯-2021-BabySmc"><a href="#4-NSS-羊城杯-2021-BabySmc" class="headerlink" title="4.NSS-[羊城杯 2021]BabySmc"></a>4.NSS-[羊城杯 2021]BabySmc</h3><p>这道题对于目前的我来讲还挺吃力的，不仅考了SMC，还考察了对于base64的理解，我当时写的时候就没有看出来base64。参考了一位师傅的博客才明白了，不得不说，师傅写的真好！！！ <a target="_blank" rel="noopener" href="https://blog.csdn.net/xiao__1bai/article/details/120342289">https://blog.csdn.net/xiao__1bai/article/details/120342289</a></p>
<p>使用IDA打开，然后分析主函数</p>
<p><img src="https://cdn.jsdelivr.net/gh/seeker-fang/Images//202507211525530.png"></p>
<p>v4里面存放的是用户输入的flag，知道lpAddress和 qword_7FF62CC1AD88分别是起始和结束地址。然后看看<code>sub_7FF62CBF1E30()</code>函数。</p>
<p><img src="https://cdn.jsdelivr.net/gh/seeker-fang/Images//202507211535138.png"></p>
<p>发现这里有VirtualProtect 函数，修改了起始地址和结束地址的权限，进行了解密，所以这个是数据的解密函数。</p>
<p>我们接着看被IDA错误识别的汇编</p>
<p><img src="https://cdn.jsdelivr.net/gh/seeker-fang/Images//202507211544090.png"></p>
<p>发现这里有很多大块的没有被识别出来的数据，不是花指令的话，那就是smc了。看到上面调用了解密函数，我们可以使用动态调试dump出来。在解密函数处打上断点，进行调试分析。提示输入flag时，随便输就好了，这个不影响后续的分析。我们按F8进行单步步过，这时候会出现一个弹窗，意思是是否让IDA自己根据RIP生成代码，这里选no，因为IDA不知道哪里是代码，哪里是数据，如果根据RIP进行分析，就可能会错误的把数据当成代码，从而整个<code>main</code>函数结构就被拆分了。</p>
<p><img src="https://cdn.jsdelivr.net/gh/seeker-fang/Images//202507211549157.png"></p>
<p>然后我们看到了这里有更多的大块数据，没有正确识别出来</p>
<p><img src="https://cdn.jsdelivr.net/gh/seeker-fang/Images//202507211556514.png"></p>
<p>我们直接从Main函数头开始选中，一直选到第一个retn为止</p>
<p><img src="https://cdn.jsdelivr.net/gh/seeker-fang/Images//202507211559529.png"></p>
<p>然后按C，选择<strong>Force</strong>进行强制分析，然后按F5就能进行反编译了。</p>
<p>得到的完整的函数如下所示：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> __fastcall <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 v3; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">char</span> v4; <span class="comment">// sp</span></span><br><span class="line">  <span class="type">char</span> v5; <span class="comment">// cl</span></span><br><span class="line">  __int64 v6; <span class="comment">// rcx</span></span><br><span class="line">  __int64 v8; <span class="comment">// rax</span></span><br><span class="line">  __int64 v9; <span class="comment">// rcx</span></span><br><span class="line">  <span class="type">unsigned</span> __int128 v10; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v11; <span class="comment">// rdi</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v12; <span class="comment">// r9</span></span><br><span class="line">  <span class="type">int</span> v13; <span class="comment">// r8d</span></span><br><span class="line">  <span class="type">int</span> v14; <span class="comment">// r10d</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v15; <span class="comment">// rsi</span></span><br><span class="line">  __int64 v16; <span class="comment">// rax</span></span><br><span class="line">  __int64 v17; <span class="comment">// rdx</span></span><br><span class="line">  <span class="type">int</span> v18; <span class="comment">// r11d</span></span><br><span class="line">  <span class="type">int</span> v19; <span class="comment">// r13d</span></span><br><span class="line">  <span class="type">int</span> v20; <span class="comment">// ebx</span></span><br><span class="line">  <span class="type">int</span> v21; <span class="comment">// r12d</span></span><br><span class="line">  __int64 v22; <span class="comment">// r13</span></span><br><span class="line">  <span class="type">int</span> v23; <span class="comment">// r11d</span></span><br><span class="line">  __int64 v24; <span class="comment">// rbx</span></span><br><span class="line">  __int64 v25; <span class="comment">// r11</span></span><br><span class="line">  <span class="type">int</span> v26; <span class="comment">// r12d</span></span><br><span class="line">  __int64 v27; <span class="comment">// rbx</span></span><br><span class="line">  __int64 v28; <span class="comment">// r11</span></span><br><span class="line">  <span class="type">int</span> v29; <span class="comment">// r12d</span></span><br><span class="line">  __int64 v30; <span class="comment">// r13</span></span><br><span class="line">  __int64 v31; <span class="comment">// rbx</span></span><br><span class="line">  __int64 v32; <span class="comment">// r11</span></span><br><span class="line">  <span class="type">int</span> v33; <span class="comment">// r12d</span></span><br><span class="line">  __int64 v34; <span class="comment">// rbx</span></span><br><span class="line">  __int64 v35; <span class="comment">// r11</span></span><br><span class="line">  <span class="type">int</span> v36; <span class="comment">// r12d</span></span><br><span class="line">  __int64 v37; <span class="comment">// r13</span></span><br><span class="line">  __int64 v38; <span class="comment">// rbx</span></span><br><span class="line">  __int64 v39; <span class="comment">// r11</span></span><br><span class="line">  <span class="type">int</span> v40; <span class="comment">// r12d</span></span><br><span class="line">  __int64 v41; <span class="comment">// rbx</span></span><br><span class="line">  __int64 v42; <span class="comment">// r11</span></span><br><span class="line">  <span class="type">int</span> v43; <span class="comment">// r12d</span></span><br><span class="line">  __int64 v44; <span class="comment">// r13</span></span><br><span class="line">  __int64 v45; <span class="comment">// rbx</span></span><br><span class="line">  __int64 v46; <span class="comment">// r11</span></span><br><span class="line">  <span class="type">int</span> v47; <span class="comment">// r12d</span></span><br><span class="line">  __int64 v48; <span class="comment">// rbx</span></span><br><span class="line">  __int64 v49; <span class="comment">// r11</span></span><br><span class="line">  <span class="type">int</span> v50; <span class="comment">// r12d</span></span><br><span class="line">  __int64 v51; <span class="comment">// r13</span></span><br><span class="line">  __int64 v52; <span class="comment">// rbx</span></span><br><span class="line">  __int64 v53; <span class="comment">// r11</span></span><br><span class="line">  <span class="type">int</span> v54; <span class="comment">// r12d</span></span><br><span class="line">  __int64 v55; <span class="comment">// rbx</span></span><br><span class="line">  __int64 v56; <span class="comment">// r11</span></span><br><span class="line">  <span class="type">int</span> v57; <span class="comment">// r12d</span></span><br><span class="line">  __int64 v58; <span class="comment">// r13</span></span><br><span class="line">  __int64 v59; <span class="comment">// rbx</span></span><br><span class="line">  __int64 v60; <span class="comment">// r11</span></span><br><span class="line">  <span class="type">int</span> v61; <span class="comment">// r12d</span></span><br><span class="line">  __int64 v62; <span class="comment">// rbx</span></span><br><span class="line">  __int64 v63; <span class="comment">// r11</span></span><br><span class="line">  <span class="type">int</span> v64; <span class="comment">// r12d</span></span><br><span class="line">  __int64 v65; <span class="comment">// r13</span></span><br><span class="line">  <span class="type">int</span> v66; <span class="comment">// r12d</span></span><br><span class="line">  __int64 v67; <span class="comment">// r12</span></span><br><span class="line">  __int64 v68; <span class="comment">// r13</span></span><br><span class="line">  __int64 v69; <span class="comment">// r13</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v70; <span class="comment">// rax</span></span><br><span class="line">  __int64 i; <span class="comment">// r9</span></span><br><span class="line">  __int64 v72; <span class="comment">// rdx</span></span><br><span class="line">  <span class="type">int</span> v73; <span class="comment">// esi</span></span><br><span class="line">  <span class="type">int</span> v74; <span class="comment">// r8d</span></span><br><span class="line">  <span class="type">int</span> v75; <span class="comment">// r10d</span></span><br><span class="line">  __int64 v76; <span class="comment">// rcx</span></span><br><span class="line">  <span class="type">char</span> v77; <span class="comment">// al</span></span><br><span class="line">  <span class="type">char</span> v78; <span class="comment">// r9</span></span><br><span class="line">  <span class="type">int</span> v79; <span class="comment">// r9d</span></span><br><span class="line">  <span class="type">int</span> v80; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">char</span> v81; <span class="comment">// r10</span></span><br><span class="line">  <span class="type">char</span> v82; <span class="comment">// r8</span></span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> *v83; <span class="comment">// rsi</span></span><br><span class="line">  <span class="type">char</span> *v84; <span class="comment">// rdi</span></span><br><span class="line">  <span class="type">bool</span> v85; <span class="comment">// cf</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v86; <span class="comment">// dl</span></span><br><span class="line">  <span class="type">int</span> v87; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> *v88; <span class="comment">// rcx</span></span><br><span class="line">  __int64 v89; <span class="comment">// rcx</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v90; <span class="comment">// rcx</span></span><br><span class="line">  __int128 v92[<span class="number">4</span>]; <span class="comment">// [rsp+0h] [rbp-1C8h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v93[<span class="number">256</span>]; <span class="comment">// [rsp+40h] [rbp-188h] BYREF</span></span><br><span class="line">  __int128 v94[<span class="number">4</span>]; <span class="comment">// [rsp+140h] [rbp-88h]</span></span><br><span class="line">  __m128i v95; <span class="comment">// [rsp+180h] [rbp-48h] BYREF</span></span><br><span class="line">  __int128 v96; <span class="comment">// [rsp+190h] [rbp-38h]</span></span><br><span class="line">  __int128 v97; <span class="comment">// [rsp+1A0h] [rbp-28h]</span></span><br><span class="line">  __int64 v98; <span class="comment">// [rsp+1B0h] [rbp-18h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">sub_7FF62CBF1EB0</span>(<span class="number">0</span>i64, <span class="number">0</span>i64, envp);</span><br><span class="line">  v95 = <span class="number">0</span>i64;</span><br><span class="line">  v96 = <span class="number">0</span>i64;</span><br><span class="line">  v97 = <span class="number">0</span>i64;</span><br><span class="line">  <span class="built_in">sub_7FF62CBF1D40</span>(<span class="string">&quot;Input Your Flag : &quot;</span>);</span><br><span class="line">  <span class="built_in">sub_7FF62CBF1DC0</span>(<span class="string">&quot;%46s&quot;</span>, v<span class="number">95.</span>m128i_i8);</span><br><span class="line">  lpAddress = &amp;loc_7FF62CBF1085;</span><br><span class="line">  qword_7FF62CC1AD88 = (__int64)&amp;loc_7FF62CBF1D00;</span><br><span class="line">  <span class="built_in">sub_7FF62CBF1E30</span>();</span><br><span class="line">  v3 = <span class="number">16</span>i64;</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">  &#123;</span><br><span class="line">    v92[v3 + <span class="number">3</span>] = <span class="number">0</span>i64;</span><br><span class="line">    v92[v3 + <span class="number">2</span>] = <span class="number">0</span>i64;</span><br><span class="line">    v92[v3 + <span class="number">1</span>] = <span class="number">0</span>i64;</span><br><span class="line">    v92[v3] = <span class="number">0</span>i64;</span><br><span class="line">    v3 -= <span class="number">4</span>i64;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> ( v3 * <span class="number">16</span> );</span><br><span class="line">  v94[<span class="number">0</span>] = xmmword_7FF62CC<span class="number">0E340</span>;</span><br><span class="line">  v94[<span class="number">1</span>] = xmmword_7FF62CC<span class="number">0E350</span>;</span><br><span class="line">  v94[<span class="number">2</span>] = xmmword_7FF62CC<span class="number">0E360</span>;</span><br><span class="line">  v94[<span class="number">3</span>] = xmmword_7FF62CC<span class="number">0E370</span>;</span><br><span class="line">  v5 = v4 + <span class="number">0x80</span>;</span><br><span class="line">  v6 = v5 &amp; <span class="number">0xF</span>;</span><br><span class="line">  <span class="keyword">if</span> ( !_BitScanForward((<span class="type">unsigned</span> <span class="type">int</span> *)&amp;v8, (<span class="type">unsigned</span> <span class="type">int</span>)_mm_movemask_epi8(_mm_cmpeq_epi8((__m128i)<span class="number">0</span>i64, v95)) &gt;&gt; v6) )</span><br><span class="line">    v8 = <span class="built_in">sub_7FF62CBF2340</span>(v6, &amp;v<span class="number">95.</span>m128i_i8[v6]);</span><br><span class="line">  v9 = v8;</span><br><span class="line">  v10 = <span class="number">0xAAAAAAAAAAAAAAABu</span>i64 * (<span class="type">unsigned</span> __int128)(<span class="type">unsigned</span> __int64)v8;</span><br><span class="line">  v11 = *((_QWORD *)&amp;v10 + <span class="number">1</span>) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">if</span> ( *((_QWORD *)&amp;v10 + <span class="number">1</span>) &gt;&gt; <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">LODWORD</span>(v12) = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">LODWORD</span>(v10) = <span class="number">1</span>;</span><br><span class="line">    v13 = <span class="number">0</span>;</span><br><span class="line">    v14 = <span class="number">0</span>;</span><br><span class="line">    v15 = *((_QWORD *)&amp;v10 + <span class="number">1</span>) &gt;&gt; <span class="number">5</span>;</span><br><span class="line">    <span class="keyword">if</span> ( *((_QWORD *)&amp;v10 + <span class="number">1</span>) &gt;&gt; <span class="number">5</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">do</span></span><br><span class="line">      &#123;</span><br><span class="line">        v16 = v13;</span><br><span class="line">        v17 = v14;</span><br><span class="line">        v18 = v<span class="number">95.</span>m128i_i8[v13 + <span class="number">1</span>];</span><br><span class="line">        v19 = <span class="number">16</span> * (v<span class="number">95.</span>m128i_i8[v13] &amp; <span class="number">3</span>);</span><br><span class="line">        v20 = v<span class="number">95.</span>m128i_i8[v13 + <span class="number">2</span>];</span><br><span class="line">        v93[v14] = *((_BYTE *)v94 + (v<span class="number">95.</span>m128i_i8[v13] &gt;&gt; <span class="number">2</span>)) ^ <span class="number">0xA6</span>;</span><br><span class="line">        v93[v14 + <span class="number">1</span>] = *((_BYTE *)v94 + ((v18 &gt;&gt; <span class="number">4</span>) | v19)) ^ <span class="number">0xA3</span>;</span><br><span class="line">        v93[v14 + <span class="number">2</span>] = *((_BYTE *)v94 + ((v20 &gt;&gt; <span class="number">6</span>) | (<span class="number">4</span> * (v18 &amp; <span class="number">0xF</span>)))) ^ <span class="number">0xA9</span>;</span><br><span class="line">        v21 = v<span class="number">95.</span>m128i_i8[v13 + <span class="number">3</span>] &amp; <span class="number">3</span>;</span><br><span class="line">        v22 = v<span class="number">95.</span>m128i_i8[v13 + <span class="number">3</span>] &gt;&gt; <span class="number">2</span>;</span><br><span class="line">        v93[v14 + <span class="number">3</span>] = *((_BYTE *)v94 + (v20 &amp; <span class="number">0x3F</span>)) ^ <span class="number">0xAC</span>;</span><br><span class="line">        v23 = v<span class="number">95.</span>m128i_i8[v13 + <span class="number">4</span>];</span><br><span class="line">        v93[v14 + <span class="number">4</span>] = *((_BYTE *)v94 + v22) ^ <span class="number">0xA6</span>;</span><br><span class="line">        <span class="built_in">LODWORD</span>(v22) = v23;</span><br><span class="line">        v24 = v<span class="number">95.</span>m128i_i8[v13 + <span class="number">5</span>] &amp; <span class="number">0x3F</span>;</span><br><span class="line">        v25 = (v<span class="number">95.</span>m128i_i8[v13 + <span class="number">5</span>] &gt;&gt; <span class="number">6</span>) | (<span class="number">4</span> * (v23 &amp; <span class="number">0xF</span>));</span><br><span class="line">        v93[v14 + <span class="number">5</span>] = *((_BYTE *)v94 + (((<span class="type">int</span>)v22 &gt;&gt; <span class="number">4</span>) | (<span class="number">16</span> * v21))) ^ <span class="number">0xA3</span>;</span><br><span class="line">        <span class="built_in">LODWORD</span>(v22) = v<span class="number">95.</span>m128i_i8[v13 + <span class="number">6</span>];</span><br><span class="line">        v93[v14 + <span class="number">6</span>] = *((_BYTE *)v94 + v25) ^ <span class="number">0xA9</span>;</span><br><span class="line">        v93[v14 + <span class="number">7</span>] = *((_BYTE *)v94 + v24) ^ <span class="number">0xAC</span>;</span><br><span class="line">        <span class="built_in">LODWORD</span>(v25) = v<span class="number">95.</span>m128i_i8[v13 + <span class="number">7</span>];</span><br><span class="line">        v93[v14 + <span class="number">8</span>] = *((_BYTE *)v94 + ((<span class="type">int</span>)v22 &gt;&gt; <span class="number">2</span>)) ^ <span class="number">0xA6</span>;</span><br><span class="line">        v26 = v25;</span><br><span class="line">        v27 = v<span class="number">95.</span>m128i_i8[v13 + <span class="number">8</span>] &amp; <span class="number">0x3F</span>;</span><br><span class="line">        v28 = (<span class="type">int</span>)((v<span class="number">95.</span>m128i_i8[v13 + <span class="number">8</span>] &gt;&gt; <span class="number">6</span>) | (<span class="number">4</span> * (v25 &amp; <span class="number">0xF</span>)));</span><br><span class="line">        v93[v14 + <span class="number">9</span>] = *((_BYTE *)v94 + (<span class="type">int</span>)((v26 &gt;&gt; <span class="number">4</span>) | (<span class="number">16</span> * (v22 &amp; <span class="number">3</span>)))) ^ <span class="number">0xA3</span>;</span><br><span class="line">        v93[v14 + <span class="number">10</span>] = *((_BYTE *)v94 + v28) ^ <span class="number">0xA9</span>;</span><br><span class="line">        v29 = v<span class="number">95.</span>m128i_i8[v13 + <span class="number">9</span>] &amp; <span class="number">3</span>;</span><br><span class="line">        v30 = v<span class="number">95.</span>m128i_i8[v13 + <span class="number">9</span>] &gt;&gt; <span class="number">2</span>;</span><br><span class="line">        v93[v14 + <span class="number">11</span>] = *((_BYTE *)v94 + v27) ^ <span class="number">0xAC</span>;</span><br><span class="line">        <span class="built_in">LODWORD</span>(v28) = v<span class="number">95.</span>m128i_i8[v13 + <span class="number">10</span>];</span><br><span class="line">        v93[v14 + <span class="number">12</span>] = *((_BYTE *)v94 + v30) ^ <span class="number">0xA6</span>;</span><br><span class="line">        <span class="built_in">LODWORD</span>(v30) = v28;</span><br><span class="line">        v31 = v<span class="number">95.</span>m128i_i8[v13 + <span class="number">11</span>] &amp; <span class="number">0x3F</span>;</span><br><span class="line">        v32 = (<span class="type">int</span>)((v<span class="number">95.</span>m128i_i8[v13 + <span class="number">11</span>] &gt;&gt; <span class="number">6</span>) | (<span class="number">4</span> * (v28 &amp; <span class="number">0xF</span>)));</span><br><span class="line">        v93[v14 + <span class="number">13</span>] = *((_BYTE *)v94 + (((<span class="type">int</span>)v30 &gt;&gt; <span class="number">4</span>) | (<span class="number">16</span> * v29))) ^ <span class="number">0xA3</span>;</span><br><span class="line">        <span class="built_in">LODWORD</span>(v30) = v<span class="number">95.</span>m128i_i8[v13 + <span class="number">12</span>];</span><br><span class="line">        v93[v14 + <span class="number">14</span>] = *((_BYTE *)v94 + v32) ^ <span class="number">0xA9</span>;</span><br><span class="line">        v93[v14 + <span class="number">15</span>] = *((_BYTE *)v94 + v31) ^ <span class="number">0xAC</span>;</span><br><span class="line">        <span class="built_in">LODWORD</span>(v32) = v<span class="number">95.</span>m128i_i8[v13 + <span class="number">13</span>];</span><br><span class="line">        v93[v14 + <span class="number">16</span>] = *((_BYTE *)v94 + ((<span class="type">int</span>)v30 &gt;&gt; <span class="number">2</span>)) ^ <span class="number">0xA6</span>;</span><br><span class="line">        v33 = v32;</span><br><span class="line">        v34 = v<span class="number">95.</span>m128i_i8[v13 + <span class="number">14</span>] &amp; <span class="number">0x3F</span>;</span><br><span class="line">        v35 = (<span class="type">int</span>)((v<span class="number">95.</span>m128i_i8[v13 + <span class="number">14</span>] &gt;&gt; <span class="number">6</span>) | (<span class="number">4</span> * (v32 &amp; <span class="number">0xF</span>)));</span><br><span class="line">        v93[v14 + <span class="number">17</span>] = *((_BYTE *)v94 + (<span class="type">int</span>)((v33 &gt;&gt; <span class="number">4</span>) | (<span class="number">16</span> * (v30 &amp; <span class="number">3</span>)))) ^ <span class="number">0xA3</span>;</span><br><span class="line">        v93[v14 + <span class="number">18</span>] = *((_BYTE *)v94 + v35) ^ <span class="number">0xA9</span>;</span><br><span class="line">        v36 = v<span class="number">95.</span>m128i_i8[v13 + <span class="number">15</span>] &amp; <span class="number">3</span>;</span><br><span class="line">        v37 = v<span class="number">95.</span>m128i_i8[v13 + <span class="number">15</span>] &gt;&gt; <span class="number">2</span>;</span><br><span class="line">        v93[v14 + <span class="number">19</span>] = *((_BYTE *)v94 + v34) ^ <span class="number">0xAC</span>;</span><br><span class="line">        <span class="built_in">LODWORD</span>(v35) = *((<span class="type">char</span> *)&amp;v96 + v13);</span><br><span class="line">        v93[v14 + <span class="number">20</span>] = *((_BYTE *)v94 + v37) ^ <span class="number">0xA6</span>;</span><br><span class="line">        <span class="built_in">LODWORD</span>(v37) = v35;</span><br><span class="line">        v38 = *((_BYTE *)&amp;v96 + v13 + <span class="number">1</span>) &amp; <span class="number">0x3F</span>;</span><br><span class="line">        v39 = (<span class="type">int</span>)((*((<span class="type">char</span> *)&amp;v96 + v13 + <span class="number">1</span>) &gt;&gt; <span class="number">6</span>) | (<span class="number">4</span> * (v35 &amp; <span class="number">0xF</span>)));</span><br><span class="line">        v93[v14 + <span class="number">21</span>] = *((_BYTE *)v94 + (((<span class="type">int</span>)v37 &gt;&gt; <span class="number">4</span>) | (<span class="number">16</span> * v36))) ^ <span class="number">0xA3</span>;</span><br><span class="line">        <span class="built_in">LODWORD</span>(v37) = *((<span class="type">char</span> *)&amp;v96 + v13 + <span class="number">2</span>);</span><br><span class="line">        v93[v14 + <span class="number">22</span>] = *((_BYTE *)v94 + v39) ^ <span class="number">0xA9</span>;</span><br><span class="line">        v93[v14 + <span class="number">23</span>] = *((_BYTE *)v94 + v38) ^ <span class="number">0xAC</span>;</span><br><span class="line">        <span class="built_in">LODWORD</span>(v39) = *((<span class="type">char</span> *)&amp;v96 + v13 + <span class="number">3</span>);</span><br><span class="line">        v93[v14 + <span class="number">24</span>] = *((_BYTE *)v94 + ((<span class="type">int</span>)v37 &gt;&gt; <span class="number">2</span>)) ^ <span class="number">0xA6</span>;</span><br><span class="line">        v40 = v39;</span><br><span class="line">        v41 = *((_BYTE *)&amp;v96 + v13 + <span class="number">4</span>) &amp; <span class="number">0x3F</span>;</span><br><span class="line">        v42 = (<span class="type">int</span>)((*((<span class="type">char</span> *)&amp;v96 + v13 + <span class="number">4</span>) &gt;&gt; <span class="number">6</span>) | (<span class="number">4</span> * (v39 &amp; <span class="number">0xF</span>)));</span><br><span class="line">        v93[v14 + <span class="number">25</span>] = *((_BYTE *)v94 + (<span class="type">int</span>)((v40 &gt;&gt; <span class="number">4</span>) | (<span class="number">16</span> * (v37 &amp; <span class="number">3</span>)))) ^ <span class="number">0xA3</span>;</span><br><span class="line">        v93[v14 + <span class="number">26</span>] = *((_BYTE *)v94 + v42) ^ <span class="number">0xA9</span>;</span><br><span class="line">        v43 = *((_BYTE *)&amp;v96 + v13 + <span class="number">5</span>) &amp; <span class="number">3</span>;</span><br><span class="line">        v44 = *((<span class="type">char</span> *)&amp;v96 + v13 + <span class="number">5</span>) &gt;&gt; <span class="number">2</span>;</span><br><span class="line">        v93[v14 + <span class="number">27</span>] = *((_BYTE *)v94 + v41) ^ <span class="number">0xAC</span>;</span><br><span class="line">        <span class="built_in">LODWORD</span>(v42) = *((<span class="type">char</span> *)&amp;v96 + v13 + <span class="number">6</span>);</span><br><span class="line">        v93[v14 + <span class="number">28</span>] = *((_BYTE *)v94 + v44) ^ <span class="number">0xA6</span>;</span><br><span class="line">        <span class="built_in">LODWORD</span>(v44) = v42;</span><br><span class="line">        v45 = *((_BYTE *)&amp;v96 + v13 + <span class="number">7</span>) &amp; <span class="number">0x3F</span>;</span><br><span class="line">        v46 = (<span class="type">int</span>)((*((<span class="type">char</span> *)&amp;v96 + v13 + <span class="number">7</span>) &gt;&gt; <span class="number">6</span>) | (<span class="number">4</span> * (v42 &amp; <span class="number">0xF</span>)));</span><br><span class="line">        v93[v14 + <span class="number">29</span>] = *((_BYTE *)v94 + (((<span class="type">int</span>)v44 &gt;&gt; <span class="number">4</span>) | (<span class="number">16</span> * v43))) ^ <span class="number">0xA3</span>;</span><br><span class="line">        <span class="built_in">LODWORD</span>(v44) = *((<span class="type">char</span> *)&amp;v96 + v13 + <span class="number">8</span>);</span><br><span class="line">        v93[v14 + <span class="number">30</span>] = *((_BYTE *)v94 + v46) ^ <span class="number">0xA9</span>;</span><br><span class="line">        v93[v14 + <span class="number">31</span>] = *((_BYTE *)v94 + v45) ^ <span class="number">0xAC</span>;</span><br><span class="line">        <span class="built_in">LODWORD</span>(v46) = *((<span class="type">char</span> *)&amp;v96 + v13 + <span class="number">9</span>);</span><br><span class="line">        v93[v14 + <span class="number">32</span>] = *((_BYTE *)v94 + ((<span class="type">int</span>)v44 &gt;&gt; <span class="number">2</span>)) ^ <span class="number">0xA6</span>;</span><br><span class="line">        v47 = v46;</span><br><span class="line">        v48 = *((_BYTE *)&amp;v96 + v13 + <span class="number">10</span>) &amp; <span class="number">0x3F</span>;</span><br><span class="line">        v49 = (<span class="type">int</span>)((*((<span class="type">char</span> *)&amp;v96 + v13 + <span class="number">10</span>) &gt;&gt; <span class="number">6</span>) | (<span class="number">4</span> * (v46 &amp; <span class="number">0xF</span>)));</span><br><span class="line">        v93[v14 + <span class="number">33</span>] = *((_BYTE *)v94 + (<span class="type">int</span>)((v47 &gt;&gt; <span class="number">4</span>) | (<span class="number">16</span> * (v44 &amp; <span class="number">3</span>)))) ^ <span class="number">0xA3</span>;</span><br><span class="line">        v93[v14 + <span class="number">34</span>] = *((_BYTE *)v94 + v49) ^ <span class="number">0xA9</span>;</span><br><span class="line">        v50 = *((_BYTE *)&amp;v96 + v13 + <span class="number">11</span>) &amp; <span class="number">3</span>;</span><br><span class="line">        v51 = *((<span class="type">char</span> *)&amp;v96 + v13 + <span class="number">11</span>) &gt;&gt; <span class="number">2</span>;</span><br><span class="line">        v93[v14 + <span class="number">35</span>] = *((_BYTE *)v94 + v48) ^ <span class="number">0xAC</span>;</span><br><span class="line">        <span class="built_in">LODWORD</span>(v49) = *((<span class="type">char</span> *)&amp;v96 + v13 + <span class="number">12</span>);</span><br><span class="line">        v93[v14 + <span class="number">36</span>] = *((_BYTE *)v94 + v51) ^ <span class="number">0xA6</span>;</span><br><span class="line">        <span class="built_in">LODWORD</span>(v51) = v49;</span><br><span class="line">        v52 = *((_BYTE *)&amp;v96 + v13 + <span class="number">13</span>) &amp; <span class="number">0x3F</span>;</span><br><span class="line">        v53 = (<span class="type">int</span>)((*((<span class="type">char</span> *)&amp;v96 + v13 + <span class="number">13</span>) &gt;&gt; <span class="number">6</span>) | (<span class="number">4</span> * (v49 &amp; <span class="number">0xF</span>)));</span><br><span class="line">        v93[v14 + <span class="number">37</span>] = *((_BYTE *)v94 + (((<span class="type">int</span>)v51 &gt;&gt; <span class="number">4</span>) | (<span class="number">16</span> * v50))) ^ <span class="number">0xA3</span>;</span><br><span class="line">        <span class="built_in">LODWORD</span>(v51) = *((<span class="type">char</span> *)&amp;v96 + v13 + <span class="number">14</span>);</span><br><span class="line">        v93[v14 + <span class="number">38</span>] = *((_BYTE *)v94 + v53) ^ <span class="number">0xA9</span>;</span><br><span class="line">        v93[v14 + <span class="number">39</span>] = *((_BYTE *)v94 + v52) ^ <span class="number">0xAC</span>;</span><br><span class="line">        <span class="built_in">LODWORD</span>(v53) = *((<span class="type">char</span> *)&amp;v96 + v13 + <span class="number">15</span>);</span><br><span class="line">        v93[v14 + <span class="number">40</span>] = *((_BYTE *)v94 + ((<span class="type">int</span>)v51 &gt;&gt; <span class="number">2</span>)) ^ <span class="number">0xA6</span>;</span><br><span class="line">        v54 = v53;</span><br><span class="line">        v55 = *((_BYTE *)&amp;v97 + v13) &amp; <span class="number">0x3F</span>;</span><br><span class="line">        v56 = (<span class="type">int</span>)((*((<span class="type">char</span> *)&amp;v97 + v13) &gt;&gt; <span class="number">6</span>) | (<span class="number">4</span> * (v53 &amp; <span class="number">0xF</span>)));</span><br><span class="line">        v93[v14 + <span class="number">41</span>] = *((_BYTE *)v94 + (<span class="type">int</span>)((v54 &gt;&gt; <span class="number">4</span>) | (<span class="number">16</span> * (v51 &amp; <span class="number">3</span>)))) ^ <span class="number">0xA3</span>;</span><br><span class="line">        v93[v14 + <span class="number">42</span>] = *((_BYTE *)v94 + v56) ^ <span class="number">0xA9</span>;</span><br><span class="line">        v57 = *((_BYTE *)&amp;v97 + v13 + <span class="number">1</span>) &amp; <span class="number">3</span>;</span><br><span class="line">        v58 = *((<span class="type">char</span> *)&amp;v97 + v13 + <span class="number">1</span>) &gt;&gt; <span class="number">2</span>;</span><br><span class="line">        v93[v14 + <span class="number">43</span>] = *((_BYTE *)v94 + v55) ^ <span class="number">0xAC</span>;</span><br><span class="line">        <span class="built_in">LODWORD</span>(v56) = *((<span class="type">char</span> *)&amp;v97 + v13 + <span class="number">2</span>);</span><br><span class="line">        v93[v14 + <span class="number">44</span>] = *((_BYTE *)v94 + v58) ^ <span class="number">0xA6</span>;</span><br><span class="line">        <span class="built_in">LODWORD</span>(v58) = v56;</span><br><span class="line">        v59 = *((_BYTE *)&amp;v97 + v13 + <span class="number">3</span>) &amp; <span class="number">0x3F</span>;</span><br><span class="line">        v60 = (<span class="type">int</span>)((*((<span class="type">char</span> *)&amp;v97 + v13 + <span class="number">3</span>) &gt;&gt; <span class="number">6</span>) | (<span class="number">4</span> * (v56 &amp; <span class="number">0xF</span>)));</span><br><span class="line">        v93[v14 + <span class="number">45</span>] = *((_BYTE *)v94 + (((<span class="type">int</span>)v58 &gt;&gt; <span class="number">4</span>) | (<span class="number">16</span> * v57))) ^ <span class="number">0xA3</span>;</span><br><span class="line">        <span class="built_in">LODWORD</span>(v58) = *((<span class="type">char</span> *)&amp;v97 + v13 + <span class="number">4</span>);</span><br><span class="line">        v93[v14 + <span class="number">46</span>] = *((_BYTE *)v94 + v60) ^ <span class="number">0xA9</span>;</span><br><span class="line">        v93[v14 + <span class="number">47</span>] = *((_BYTE *)v94 + v59) ^ <span class="number">0xAC</span>;</span><br><span class="line">        <span class="built_in">LODWORD</span>(v60) = *((<span class="type">char</span> *)&amp;v97 + v13 + <span class="number">5</span>);</span><br><span class="line">        v93[v14 + <span class="number">48</span>] = *((_BYTE *)v94 + ((<span class="type">int</span>)v58 &gt;&gt; <span class="number">2</span>)) ^ <span class="number">0xA6</span>;</span><br><span class="line">        v61 = v60;</span><br><span class="line">        v62 = *((_BYTE *)&amp;v97 + v13 + <span class="number">6</span>) &amp; <span class="number">0x3F</span>;</span><br><span class="line">        v63 = (<span class="type">int</span>)((*((<span class="type">char</span> *)&amp;v97 + v13 + <span class="number">6</span>) &gt;&gt; <span class="number">6</span>) | (<span class="number">4</span> * (v60 &amp; <span class="number">0xF</span>)));</span><br><span class="line">        v93[v14 + <span class="number">49</span>] = *((_BYTE *)v94 + (<span class="type">int</span>)((v61 &gt;&gt; <span class="number">4</span>) | (<span class="number">16</span> * (v58 &amp; <span class="number">3</span>)))) ^ <span class="number">0xA3</span>;</span><br><span class="line">        v93[v14 + <span class="number">50</span>] = *((_BYTE *)v94 + v63) ^ <span class="number">0xA9</span>;</span><br><span class="line">        v64 = *((_BYTE *)&amp;v97 + v13 + <span class="number">7</span>) &amp; <span class="number">3</span>;</span><br><span class="line">        v65 = *((<span class="type">char</span> *)&amp;v97 + v13 + <span class="number">7</span>) &gt;&gt; <span class="number">2</span>;</span><br><span class="line">        v93[v14 + <span class="number">51</span>] = *((_BYTE *)v94 + v62) ^ <span class="number">0xAC</span>;</span><br><span class="line">        <span class="built_in">LODWORD</span>(v63) = *((<span class="type">char</span> *)&amp;v97 + v13 + <span class="number">8</span>);</span><br><span class="line">        v93[v14 + <span class="number">52</span>] = *((_BYTE *)v94 + v65) ^ <span class="number">0xA6</span>;</span><br><span class="line">        <span class="built_in">LODWORD</span>(v62) = *((<span class="type">char</span> *)&amp;v97 + v13 + <span class="number">9</span>);</span><br><span class="line">        v93[v14 + <span class="number">53</span>] = *((_BYTE *)v94 + (((<span class="type">int</span>)v63 &gt;&gt; <span class="number">4</span>) | (<span class="number">16</span> * v64))) ^ <span class="number">0xA3</span>;</span><br><span class="line">        v66 = v62;</span><br><span class="line">        v12 = (<span class="type">unsigned</span> <span class="type">int</span>)(v12 + <span class="number">1</span>);</span><br><span class="line">        v13 += <span class="number">48</span>;</span><br><span class="line">        v14 += <span class="number">64</span>;</span><br><span class="line">        <span class="built_in">LOBYTE</span>(v65) = *((_BYTE *)v94 + (v62 &amp; <span class="number">0x3F</span>));</span><br><span class="line">        <span class="built_in">LODWORD</span>(v62) = *((<span class="type">char</span> *)&amp;v97 + v16 + <span class="number">10</span>);</span><br><span class="line">        v93[v17 + <span class="number">55</span>] = v65 ^ <span class="number">0xAC</span>;</span><br><span class="line">        <span class="built_in">LODWORD</span>(v65) = *((<span class="type">char</span> *)&amp;v97 + v16 + <span class="number">11</span>);</span><br><span class="line">        v93[v17 + <span class="number">54</span>] = *((_BYTE *)v94 + (<span class="type">int</span>)((v66 &gt;&gt; <span class="number">6</span>) | (<span class="number">4</span> * (v63 &amp; <span class="number">0xF</span>)))) ^ <span class="number">0xA9</span>;</span><br><span class="line">        v93[v17 + <span class="number">56</span>] = *((_BYTE *)v94 + ((<span class="type">int</span>)v62 &gt;&gt; <span class="number">2</span>)) ^ <span class="number">0xA6</span>;</span><br><span class="line">        <span class="built_in">LODWORD</span>(v63) = (<span class="type">int</span>)v65 &gt;&gt; <span class="number">4</span>;</span><br><span class="line">        v67 = *((_BYTE *)&amp;v97 + v16 + <span class="number">12</span>) &amp; <span class="number">0x3F</span>;</span><br><span class="line">        v68 = (<span class="type">int</span>)((*((<span class="type">char</span> *)&amp;v97 + v16 + <span class="number">12</span>) &gt;&gt; <span class="number">6</span>) | (<span class="number">4</span> * (v65 &amp; <span class="number">0xF</span>)));</span><br><span class="line">        v93[v17 + <span class="number">57</span>] = *((_BYTE *)v94 + (<span class="type">int</span>)(v63 | (<span class="number">16</span> * (v62 &amp; <span class="number">3</span>)))) ^ <span class="number">0xA3</span>;</span><br><span class="line">        <span class="built_in">LOBYTE</span>(v62) = *((_BYTE *)v94 + v68);</span><br><span class="line">        v69 = *((<span class="type">char</span> *)&amp;v97 + v16 + <span class="number">13</span>) &gt;&gt; <span class="number">2</span>;</span><br><span class="line">        <span class="built_in">LODWORD</span>(v63) = *((_BYTE *)&amp;v97 + v16 + <span class="number">13</span>) &amp; <span class="number">3</span>;</span><br><span class="line">        v93[v17 + <span class="number">58</span>] = v62 ^ <span class="number">0xA9</span>;</span><br><span class="line">        v93[v17 + <span class="number">59</span>] = *((_BYTE *)v94 + v67) ^ <span class="number">0xAC</span>;</span><br><span class="line">        <span class="built_in">LOBYTE</span>(v67) = *((_BYTE *)v94 + v69);</span><br><span class="line">        <span class="built_in">LODWORD</span>(v69) = *((<span class="type">char</span> *)&amp;v97 + v16 + <span class="number">14</span>);</span><br><span class="line">        <span class="built_in">LODWORD</span>(v62) = v69 &amp; <span class="number">0xF</span>;</span><br><span class="line">        <span class="built_in">LODWORD</span>(v63) = ((<span class="type">int</span>)v69 &gt;&gt; <span class="number">4</span>) | (<span class="number">16</span> * v63);</span><br><span class="line">        <span class="built_in">LODWORD</span>(v69) = *((<span class="type">char</span> *)&amp;v97 + v16 + <span class="number">15</span>);</span><br><span class="line">        v93[v17 + <span class="number">60</span>] = v67 ^ <span class="number">0xA6</span>;</span><br><span class="line">        <span class="built_in">LOBYTE</span>(v67) = *((_BYTE *)v94 + (<span class="type">int</span>)v63) ^ <span class="number">0xA3</span>;</span><br><span class="line">        <span class="built_in">LOBYTE</span>(v63) = *((_BYTE *)v94 + (((<span class="type">int</span>)v69 &gt;&gt; <span class="number">6</span>) | (<span class="number">4</span> * (<span class="type">int</span>)v62))) ^ <span class="number">0xA9</span>;</span><br><span class="line">        <span class="built_in">LOBYTE</span>(v62) = *((_BYTE *)v94 + (v69 &amp; <span class="number">0x3F</span>)) ^ <span class="number">0xAC</span>;</span><br><span class="line">        v93[v17 + <span class="number">61</span>] = v67;</span><br><span class="line">        v93[v17 + <span class="number">62</span>] = v63;</span><br><span class="line">        v93[v17 + <span class="number">63</span>] = v62;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">while</span> ( v12 &lt; v15 );</span><br><span class="line">      <span class="built_in">LODWORD</span>(v10) = <span class="number">16</span> * v12 + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    v70 = (<span class="type">unsigned</span> <span class="type">int</span>)(v10 - <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">3</span> * (<span class="type">int</span>)v70; v70 &lt; v11; v93[v72 + <span class="number">3</span>] = v73 )</span><br><span class="line">    &#123;</span><br><span class="line">      v72 = <span class="number">4</span> * (<span class="type">int</span>)v70;</span><br><span class="line">      v70 = (<span class="type">unsigned</span> <span class="type">int</span>)(v70 + <span class="number">1</span>);</span><br><span class="line">      v73 = v<span class="number">95.</span>m128i_i8[i + <span class="number">1</span>];</span><br><span class="line">      v74 = <span class="number">16</span> * (v<span class="number">95.</span>m128i_i8[i] &amp; <span class="number">3</span>);</span><br><span class="line">      v93[v72] = *((_BYTE *)v94 + (v<span class="number">95.</span>m128i_i8[i] &gt;&gt; <span class="number">2</span>)) ^ <span class="number">0xA6</span>;</span><br><span class="line">      v75 = v<span class="number">95.</span>m128i_i8[i + <span class="number">2</span>];</span><br><span class="line">      i += <span class="number">3</span>i64;</span><br><span class="line">      v93[v72 + <span class="number">1</span>] = *((_BYTE *)v94 + ((v73 &gt;&gt; <span class="number">4</span>) | v74)) ^ <span class="number">0xA3</span>;</span><br><span class="line">      <span class="built_in">LOBYTE</span>(v74) = *((_BYTE *)v94 + ((v75 &gt;&gt; <span class="number">6</span>) | (<span class="number">4</span> * (v73 &amp; <span class="number">0xF</span>)))) ^ <span class="number">0xA9</span>;</span><br><span class="line">      <span class="built_in">LOBYTE</span>(v73) = *((_BYTE *)v94 + (v75 &amp; <span class="number">0x3F</span>)) ^ <span class="number">0xAC</span>;</span><br><span class="line">      v93[v72 + <span class="number">2</span>] = v74;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  v76 = v9 - <span class="number">3</span> * v11;</span><br><span class="line">  <span class="keyword">if</span> ( v76 == <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v77 = v<span class="number">95.</span>m128i_i8[<span class="number">3</span> * v11];</span><br><span class="line">    v93[<span class="number">4</span> * v11 + <span class="number">2</span>] = <span class="number">49</span>;</span><br><span class="line">    v93[<span class="number">4</span> * v11 + <span class="number">3</span>] = <span class="number">52</span>;</span><br><span class="line">    v78 = *((_BYTE *)v94 + (<span class="type">unsigned</span> __int8)(<span class="number">16</span> * (v77 &amp; <span class="number">3</span>))) ^ <span class="number">0xA3</span>;</span><br><span class="line">    v93[<span class="number">4</span> * v11] = *((_BYTE *)v94 + (v77 &gt;&gt; <span class="number">2</span>)) ^ <span class="number">0xA6</span>;</span><br><span class="line">    v93[<span class="number">4</span> * v11 + <span class="number">1</span>] = v78;</span><br><span class="line">    v93[<span class="number">4</span> * v11 + <span class="number">4</span>] = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> ( v76 == <span class="number">2</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v79 = v<span class="number">95.</span>m128i_i8[<span class="number">3</span> * v11 + <span class="number">1</span>];</span><br><span class="line">    v80 = v<span class="number">95.</span>m128i_i8[<span class="number">3</span> * v11];</span><br><span class="line">    v81 = *((_BYTE *)v94 + <span class="number">4</span> * (v79 &amp; <span class="number">0xFu</span>)) ^ <span class="number">0xA9</span>;</span><br><span class="line">    v82 = *((_BYTE *)v94 + ((v79 &gt;&gt; <span class="number">4</span>) | (<span class="number">16</span> * (v80 &amp; <span class="number">3</span>)))) ^ <span class="number">0xA3</span>;</span><br><span class="line">    v93[<span class="number">4</span> * v11] = *((_BYTE *)v94 + (v80 &gt;&gt; <span class="number">2</span>)) ^ <span class="number">0xA6</span>;</span><br><span class="line">    v93[<span class="number">4</span> * v11 + <span class="number">1</span>] = v82;</span><br><span class="line">    v93[<span class="number">4</span> * v11 + <span class="number">2</span>] = v81;</span><br><span class="line">    v93[<span class="number">4</span> * v11 + <span class="number">3</span>] = <span class="number">52</span>;</span><br><span class="line">    v93[<span class="number">4</span> * v11 + <span class="number">4</span>] = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    v93[<span class="number">4</span> * v11] = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  v83 = <span class="string">&quot;H&gt;oQn6aqLr&#123;DH6odhdm0dMe`MBo?lRglHtGPOdobDlknejmGI|ghDb&lt;4&quot;</span>;</span><br><span class="line">  v84 = v93;</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v85 = (<span class="type">unsigned</span> __int8)*v84 &lt; (<span class="type">unsigned</span> <span class="type">int</span>)*v83;</span><br><span class="line">    <span class="keyword">if</span> ( *v84 != *v83 )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">if</span> ( !*v84 )</span><br><span class="line">      <span class="keyword">goto</span> LABEL_21;</span><br><span class="line">    v86 = v84[<span class="number">1</span>];</span><br><span class="line">    v85 = v86 &lt; (<span class="type">unsigned</span> <span class="type">int</span>)v83[<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">if</span> ( v86 != v83[<span class="number">1</span>] )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    v84 += <span class="number">2</span>;</span><br><span class="line">    v83 += <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">if</span> ( !v86 )</span><br><span class="line">    &#123;</span><br><span class="line">LABEL_21:</span><br><span class="line">      v87 = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">goto</span> LABEL_23;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  v87 = v85 ? <span class="number">-1</span> : <span class="number">1</span>;</span><br><span class="line">LABEL_23:</span><br><span class="line">  v88 = <span class="string">&quot;No.\r\n&quot;</span>;</span><br><span class="line">  <span class="keyword">if</span> ( !v87 )</span><br><span class="line">    v88 = <span class="string">&quot;Yes.\r\n&quot;</span>;</span><br><span class="line">  <span class="built_in">sub_7FF62CBF1D40</span>(v88);</span><br><span class="line">  <span class="built_in">sub_7FF62CBF6B38</span>(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">  v89 = v98;</span><br><span class="line">  v98 = <span class="number">0</span>i64;</span><br><span class="line">  v90 = (<span class="type">unsigned</span> __int64)v92 ^ v89;</span><br><span class="line">  <span class="keyword">if</span> ( v90 == _security_cookie )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">sub_7FF62CBF1D40</span>(v90);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>进行分析代码，这个代码量有点多欸。通过代码的大概形式我们可以知道这个类似base64加密，其中</p>
<p><img src="https://cdn.jsdelivr.net/gh/seeker-fang/Images//202507211623588.png"></p>
<p>这些&gt;&gt;2 , &gt;&gt;4 , &gt;&gt;6 , &amp;3 , &amp;0xF , &amp;0x3F , *16就是&lt;&lt;4,（<strong>v*(2^n)&#x3D;&#x3D;v&lt;&lt;n</strong>）这看起来就像是base64从3 * 8，到4 * 6的实现。</p>
<p>举个例子</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">原始字节流：      [<span class="number">11111111</span>] [<span class="number">10101010</span>] [<span class="number">01010101</span>]</span><br><span class="line">位数编号：         <span class="number">00000000</span> <span class="number">00000001</span> <span class="number">00000010</span> （共<span class="number">3</span>字节）</span><br><span class="line">总共<span class="number">24</span>位，把它们分为<span class="number">4</span>组，每组<span class="number">6</span>位：</span><br><span class="line">    第<span class="number">1</span>组: 位<span class="number">0</span>-<span class="number">5</span>   → (<span class="keyword">data</span>[<span class="number">0</span>] &gt;&gt; <span class="number">2</span>)</span><br><span class="line">    第<span class="number">2</span>组: 位<span class="number">6</span>-<span class="number">11</span>  → ((<span class="keyword">data</span>[<span class="number">0</span>] &amp; <span class="number">0x3</span>) &lt;&lt; <span class="number">4</span>) | (<span class="keyword">data</span>[<span class="number">1</span>] &gt;&gt; <span class="number">4</span>)</span><br><span class="line">    第<span class="number">3</span>组: 位<span class="number">12</span>-<span class="number">17</span> → ((<span class="keyword">data</span>[<span class="number">1</span>] &amp; <span class="number">0xf</span>) &lt;&lt; <span class="number">2</span>) | (<span class="keyword">data</span>[<span class="number">2</span>] &gt;&gt; <span class="number">6</span>)</span><br><span class="line">    第<span class="number">4</span>组: 位<span class="number">18</span>-<span class="number">23</span> → (<span class="keyword">data</span>[<span class="number">2</span>] &amp; <span class="number">0x3f</span>)</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<p>‘&gt;&gt;2’  # 取出高6位<br>&amp; 0x3   # 保留最后两位（低2位）<br>&lt;&lt; 4    # 左移填充到高位（准备拼接）<br>&amp; 0xf   # 取中间4位（低4位）<br>&lt;&lt; 2    # 左移再准备拼接<br>&amp; 0x3f  # 最终保留6位结果</p>
</blockquote>
</blockquote>
<p>但是这里还有不同的就是这里多了异或操作<code>^0xA6 , ^0xA3 , ^0xA9 , ^0xAc</code>，还有这个还是个变表，真正的表是 v94</p>
<p> v94[0] &#x3D; xmmword_7FF62CC0E340;  v94[1] &#x3D; xmmword_7FF62CC0E350;<br> v94[2] &#x3D; xmmword_7FF62CC0E360;  v94[3] &#x3D; xmmword_7FF62CC0E370;</p>
<p><img src="https://cdn.jsdelivr.net/gh/seeker-fang/Images//202507211643314.png"></p>
<p>大致分析后，知道**”H&gt;oQn6aqLr{DH6odhdm0dMe&#96;MBo?lRglHtGPOdobDlknejmGI|ghDb&lt;4”**这就是加密后的结果，我们对其要进行解密，解密脚本参考了师傅写的。哎，看来我得好好看看base64了……</p>
<p><strong>exp</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">res=<span class="string">&quot;H&gt;oQn6aqLr&#123;DH6odhdm0dMe`MBo?lRglHtGPOdobDlknejmGI|ghDb&lt;&quot;</span></span><br><span class="line">key=[<span class="number">0xA6</span>,<span class="number">0xA3</span>,<span class="number">0xA9</span>,<span class="number">0xAC</span>]</span><br><span class="line">flag=[]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(res)):</span><br><span class="line">    flag+=[<span class="built_in">ord</span>(res[i]) ^ key[i%<span class="built_in">len</span>(key)]]</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line">table=[<span class="number">0xE4</span>, <span class="number">0xC4</span>, <span class="number">0xE7</span>, <span class="number">0xC7</span>, <span class="number">0xE6</span>, <span class="number">0xC6</span>, <span class="number">0xE1</span>, </span><br><span class="line"><span class="number">0xC1</span>, <span class="number">0xE0</span>, <span class="number">0xC0</span>, <span class="number">0xE3</span>, <span class="number">0xC3</span>, <span class="number">0xE2</span>, <span class="number">0xC2</span>, <span class="number">0xED</span>, </span><br><span class="line"><span class="number">0xCD</span>, <span class="number">0xEC</span>,<span class="number">0xCC</span>, <span class="number">0xEF</span>, <span class="number">0xCF</span>, <span class="number">0xEE</span>, <span class="number">0xCE</span>, <span class="number">0xE9</span>, <span class="number">0xC9</span>, </span><br><span class="line"><span class="number">0xE8</span>, <span class="number">0xC8</span>, <span class="number">0xEB</span>, <span class="number">0xCB</span>, <span class="number">0xEA</span>, <span class="number">0xCA</span>, <span class="number">0xF5</span>, <span class="number">0xD5</span>, <span class="number">0xF4</span>, </span><br><span class="line"><span class="number">0xD4</span>, <span class="number">0xF7</span>, <span class="number">0xD7</span>, <span class="number">0xF6</span>, <span class="number">0xD6</span>, <span class="number">0xF1</span>, <span class="number">0xD1</span>, <span class="number">0xF0</span>, <span class="number">0xD0</span>, </span><br><span class="line"><span class="number">0xF3</span>, <span class="number">0xD3</span>, <span class="number">0xF2</span>, <span class="number">0xD2</span>, <span class="number">0xFD</span>, <span class="number">0xDD</span>, <span class="number">0xFC</span>, <span class="number">0xDC</span>, <span class="number">0xFF</span>, </span><br><span class="line"><span class="number">0xDF</span>, <span class="number">0x95</span>, <span class="number">0x9C</span>, <span class="number">0x9D</span>, <span class="number">0x92</span>, <span class="number">0x93</span>, <span class="number">0x90</span>, <span class="number">0x91</span>, <span class="number">0x96</span>, </span><br><span class="line"><span class="number">0x97</span>, <span class="number">0x94</span>, <span class="number">0x8A</span>, <span class="number">0x8E</span>]</span><br><span class="line">result=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="comment">#flag根据再table中的索引值全部转化为二进制，放入table中，不够6位的需要补齐</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> flag:</span><br><span class="line">    result+=(<span class="string">&#x27;&#123;:0&gt;6&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">bin</span>(table.index(i)).replace(<span class="string">&quot;0b&quot;</span>,<span class="string">&quot;&quot;</span>)))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(result),<span class="number">8</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(<span class="built_in">int</span>(result[i:i+<span class="number">8</span>],<span class="number">2</span>)),end=<span class="string">&quot;&quot;</span>)</span><br><span class="line"><span class="comment">#SangFor&#123;XSAYT0u5DQhaxveIR50X1U13M-pZK5A0&#125;      </span></span><br></pre></td></tr></table></figure>

<h3 id="5-NewStar-SMc-math"><a href="#5-NewStar-SMc-math" class="headerlink" title="5.NewStar-SMc_math"></a>5.NewStar-SMc_math</h3><p>这个是ELF64位的程序，使用IDA打开，进行分析</p>
<p><img src="https://cdn.jsdelivr.net/gh/seeker-fang/Images//202507211712479.png"></p>
<p>我们看到了<strong>mprotect()函数</strong>这就很明显是一个SMC了，这个函数是对encrypt进行修改权限，要求输入的flag长度为28，并且这个encrypt就是最后的加密验证函数，我们可以使用ELF文件动调来看，先下断点到<code>if ( (unsigned int)((__int64 (__fastcall *)(char *))encrypt)(s) )</code>这一行，此时是解密完成的状态。这里主要介绍第二种方法，使用解密脚本。我们也可以使用IDAPython 进行解密，知道解密方法是和0x3E进行异或，并且知道了解密的长度，现在要找到起始地址就ok了。</p>
<img src="https://cdn.jsdelivr.net/gh/seeker-fang/Images//202507211826412.png" style="zoom:80%;" />

<p>IDAPython脚本如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Patch encrypt 函数加密内容</span></span><br><span class="line">start = <span class="number">0x11E9</span>  <span class="comment"># encrypt 函数起始地址</span></span><br><span class="line">length = <span class="number">0x3D6</span>  <span class="comment"># 总共需要解密的长度</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(length):</span><br><span class="line">    b = ida_bytes.get_byte(start + i)</span><br><span class="line">    ida_bytes.patch_byte(start + i, b ^ <span class="number">0x3E</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Decrypt done.&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>在IDA中打开 File-&gt;Script command…-&gt;将IDA改成python</p>
<p>​	<img src="https://cdn.jsdelivr.net/gh/seeker-fang/Images//202507211828967.png"></p>
<p>运行后，我们发现这就发生了很大的变化，原来大块的数据都没有了。我们从函数头一直选中到函数尾也就是retn的位置，然后按C强制进行分析。</p>
<img src="https://cdn.jsdelivr.net/gh/seeker-fang/Images//202507211830503.png" style="zoom:80%;" />

<p>再在函数头先U解除定义一下，再P重新定义，就能F5进行反编译了</p>
<img src="https://cdn.jsdelivr.net/gh/seeker-fang/Images//202507211832579.png"  />

<p>方程式，使用z3求解</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># 声明7个未知的64位无符号整数变量</span></span><br><span class="line">v = [BitVec(<span class="string">f&#x27;v<span class="subst">&#123;i&#125;</span>&#x27;</span>, <span class="number">64</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>)]</span><br><span class="line"></span><br><span class="line">s = Solver()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加约束</span></span><br><span class="line">s.add(<span class="number">5</span> * (v[<span class="number">1</span>] + v[<span class="number">0</span>]) + <span class="number">4</span> * v[<span class="number">2</span>] + <span class="number">6</span> * v[<span class="number">3</span>] + v[<span class="number">4</span>] + <span class="number">9</span> * v[<span class="number">6</span>] + <span class="number">2</span> * v[<span class="number">5</span>] == <span class="number">0xD5CC7D4FF</span>)</span><br><span class="line">s.add(<span class="number">4</span> * v[<span class="number">6</span>] + <span class="number">3</span> * v[<span class="number">3</span>] + <span class="number">6</span> * v[<span class="number">2</span>] + <span class="number">10</span> * v[<span class="number">1</span>] + <span class="number">9</span> * v[<span class="number">0</span>] + <span class="number">9</span> * v[<span class="number">5</span>] + <span class="number">3</span> * v[<span class="number">4</span>] == <span class="number">0x102335844B</span>)</span><br><span class="line">s.add(<span class="number">9</span> * v[<span class="number">4</span>] + <span class="number">4</span> * (v[<span class="number">3</span>] + v[<span class="number">2</span>]) + <span class="number">5</span> * v[<span class="number">1</span>] + <span class="number">4</span> * v[<span class="number">0</span>] + <span class="number">3</span> * v[<span class="number">6</span>] + <span class="number">10</span> * v[<span class="number">5</span>] == <span class="number">0xD55AEABB9</span>)</span><br><span class="line">s.add(<span class="number">9</span> * v[<span class="number">1</span>] + <span class="number">5</span> * v[<span class="number">0</span>] + <span class="number">9</span> * v[<span class="number">6</span>] + <span class="number">2</span> * (v[<span class="number">2</span>] + <span class="number">2</span> * v[<span class="number">3</span>] + <span class="number">5</span> * v[<span class="number">4</span>] + v[<span class="number">5</span>]) == <span class="number">0xF89F6B7FA</span>)</span><br><span class="line">s.add(<span class="number">5</span> * v[<span class="number">4</span>] + <span class="number">9</span> * v[<span class="number">3</span>] + <span class="number">7</span> * v[<span class="number">0</span>] + <span class="number">2</span> * v[<span class="number">1</span>] + v[<span class="number">2</span>] + <span class="number">3</span> * v[<span class="number">6</span>] + <span class="number">9</span> * v[<span class="number">5</span>] == <span class="number">0xD5230B80B</span>)</span><br><span class="line">s.add(<span class="number">8</span> * v[<span class="number">6</span>] + <span class="number">6</span> * v[<span class="number">3</span>] + <span class="number">10</span> * v[<span class="number">2</span>] + <span class="number">5</span> * v[<span class="number">1</span>] + <span class="number">6</span> * v[<span class="number">0</span>] + <span class="number">3</span> * v[<span class="number">5</span>] + <span class="number">9</span> * v[<span class="number">4</span>] == <span class="number">0x11E28ED873</span>)</span><br><span class="line">s.add(v[<span class="number">0</span>] + <span class="number">4</span> * (v[<span class="number">2</span>] + v[<span class="number">1</span>] + <span class="number">2</span> * v[<span class="number">3</span>]) + <span class="number">9</span> * v[<span class="number">4</span>] + v[<span class="number">5</span>] + <span class="number">3</span> * v[<span class="number">6</span>] == <span class="number">0xB353C03E1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 求解</span></span><br><span class="line"><span class="keyword">if</span> s.check() == sat:</span><br><span class="line">    model = s.model()</span><br><span class="line">    result = [model[v[i]].as_long() <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>)]</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;解为:&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> i, val <span class="keyword">in</span> <span class="built_in">enumerate</span>(result):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;v<span class="subst">&#123;i&#125;</span> = <span class="subst">&#123;val&#125;</span> (0x<span class="subst">&#123;val:016X&#125;</span>)&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 将每个 64 位整数转换为 8 字节字符串（小端顺序）</span></span><br><span class="line">    flag = <span class="string">b&#x27;&#x27;</span>.join(val.to_bytes(<span class="number">8</span>, <span class="string">&#x27;little&#x27;</span>) <span class="keyword">for</span> val <span class="keyword">in</span> result)</span><br><span class="line">    <span class="comment"># 去除非 ASCII 或不可打印字符（如果需要）</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\n拼接后的字符串为:&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(flag.decode(<span class="string">&#x27;ascii&#x27;</span>, errors=<span class="string">&#x27;ignore&#x27;</span>))  <span class="comment"># 或 &#x27;replace&#x27; 替换非法字符</span></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;转换为字符串失败:&quot;</span>, e)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;无解&quot;</span>)</span><br><span class="line"><span class="comment">#   解为:</span></span><br><span class="line"><span class="comment">#v0 = 1734437990 (0x0000000067616C66)</span></span><br><span class="line"><span class="comment">#v1 = 1596998779 (0x000000005F30447B)</span></span><br><span class="line"><span class="comment">#v2 = 1601515609 (0x000000005F753059)</span></span><br><span class="line"><span class="comment">#v3 = 1999662667 (0x0000000077306E4B)</span></span><br><span class="line"><span class="comment">#v4 = 1129149279 (0x00000000434D735F)</span></span><br><span class="line"><span class="comment">#v5 = 1148073055 (0x00000000446E345F)</span></span><br><span class="line"><span class="comment">#v6 = 2100517471 (0x000000007D335A5F)</span></span><br><span class="line"><span class="comment">#拼接后的字符串为:</span></span><br><span class="line"><span class="comment">#flag&#123;D0_Y0u_Kn0w_sMC_4nD_Z3&#125;</span></span><br></pre></td></tr></table></figure>

</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://example.com">第二支羽毛</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2025/07/21/SMC/">http://example.com/2025/07/21/SMC/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="http://example.com" target="_blank">Born to Shine</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/SMC/">SMC</a></div><div class="post-share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/seeker-fang/Images//202502222116882.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/07/21/picoCTF%202024/" title="picoCTF 2024"><img class="cover" src="https://cdn.jsdelivr.net/gh/seeker-fang/Images//202502222102230.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">picoCTF 2024</div></div><div class="info-2"><div class="info-item-1">picoCTF 2024Re复现1.packer题目描述Reverse this linux executable? 反转这个 Linux 可执行文件？ 解题思路题目附件是一个可执行的ELF64文件，将它先放入DIE里查壳，发现有UPX壳，首先要进行脱壳。  这是最简单的UPX壳。脱完后我们将它放入IDA里进行静态分析。   逻辑简单清晰，flag显而易见就是v13的内容。 构造exp解出flag即可。  exp12a=bytes.fromhex(&quot;7069636f4354467b5539585f556e5034636b314e365f42316e34526933535f35646565343434317d&quot;).decode()print(a)    2.FactCheck题目描述This binary is putting together some important piece of information… Can you uncover that information?Examine this file. Do you understand...</div></div></div></a><a class="pagination-related" href="/2025/07/21/%E5%8F%8D%E8%B0%83%E8%AF%95/" title="反调试"><img class="cover" src="https://cdn.jsdelivr.net/gh/seeker-fang/Images//202502222116881.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">反调试</div></div><div class="info-2"><div class="info-item-1">反调试反调试是什么？反调试是用来检测并阻止程序被调试器（debugger）分析的一种技术，当程序意识到自己可能处于调试中的时候，可能会改变正常的执行路径或者修改自身程序让自己崩溃，从而增加调试时间和复杂度。 函数检测函数检测就是通过 Windows 自带的公开或未公开的函数直接检测程序是否处于调试状态。    Windows API 作用    IsDebuggerPresent 检测当前进程是否被调试   CheckRemoteDebuggerPresent 检测一个远程进程是否处于调试状态   NtQueryInformationProcess() 获取进程信息，判断调试状态   IsDebuggerPresent1BOOL WINAPI IsDebuggerPresent(void);  该函数查询进程环境块（PEB）中的 BeingDebugged 标志，如果进程处在调试上下文中，则返回1，否则返回0。 CheckRemoteDebuggerPresent1234BOOL WINAPI CheckRemoteDebuggerPresent(  _In_   ...</div></div></div></a></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="https://cdn.jsdelivr.net/gh/seeker-fang/Images//202502222128421.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">第二支羽毛</div><div class="author-info-description">观我旧往，同我仰春</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">16</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">9</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/seeker-fang"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/seeker-fang" target="_blank" title="Github"><i class="fab fa-github"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">总要记些什么证明我来过</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#SMC"><span class="toc-number">1.</span> <span class="toc-text">SMC</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFSMC"><span class="toc-number">1.1.</span> <span class="toc-text">什么是SMC</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BE%8B%E9%A2%98"><span class="toc-number">1.2.</span> <span class="toc-text">例题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-NSS-%E7%BD%91%E9%BC%8E%E6%9D%AF-2020-%E9%9D%92%E9%BE%99%E7%BB%84-jocker"><span class="toc-number">1.2.1.</span> <span class="toc-text">1.NSS-[网鼎杯 2020 青龙组]jocker</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-NSSRound-2-Able-findxenny"><span class="toc-number">1.2.2.</span> <span class="toc-text">2.[NSSRound#2 Able]findxenny</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-NSS-HDCTF-2023-enc"><span class="toc-number">1.2.3.</span> <span class="toc-text">3.NSS-[HDCTF 2023]enc</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-NSS-%E7%BE%8A%E5%9F%8E%E6%9D%AF-2021-BabySmc"><span class="toc-number">1.2.4.</span> <span class="toc-text">4.NSS-[羊城杯 2021]BabySmc</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-NewStar-SMc-math"><span class="toc-number">1.2.5.</span> <span class="toc-text">5.NewStar-SMc_math</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/08/27/UPX%E6%89%8B%E8%84%B1%E5%A3%B3/" title="UPX手脱壳"><img src="https://cdn.jsdelivr.net/gh/seeker-fang/Images//202502222102230.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="UPX手脱壳"/></a><div class="content"><a class="title" href="/2025/08/27/UPX%E6%89%8B%E8%84%B1%E5%A3%B3/" title="UPX手脱壳">UPX手脱壳</a><time datetime="2025-08-27T08:33:19.000Z" title="发表于 2025-08-27 16:33:19">2025-08-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/07/21/%E5%8F%8D%E8%B0%83%E8%AF%95/" title="反调试"><img src="https://cdn.jsdelivr.net/gh/seeker-fang/Images//202502222116881.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="反调试"/></a><div class="content"><a class="title" href="/2025/07/21/%E5%8F%8D%E8%B0%83%E8%AF%95/" title="反调试">反调试</a><time datetime="2025-07-21T14:19:47.000Z" title="发表于 2025-07-21 22:19:47">2025-07-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/07/21/SMC/" title="SMC"><img src="https://cdn.jsdelivr.net/gh/seeker-fang/Images//202502222116882.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="SMC"/></a><div class="content"><a class="title" href="/2025/07/21/SMC/" title="SMC">SMC</a><time datetime="2025-07-21T13:19:47.000Z" title="发表于 2025-07-21 21:19:47">2025-07-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/07/21/picoCTF%202024/" title="picoCTF 2024"><img src="https://cdn.jsdelivr.net/gh/seeker-fang/Images//202502222102230.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="picoCTF 2024"/></a><div class="content"><a class="title" href="/2025/07/21/picoCTF%202024/" title="picoCTF 2024">picoCTF 2024</a><time datetime="2025-07-21T12:19:47.000Z" title="发表于 2025-07-21 20:19:47">2025-07-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/07/17/%E8%8A%B1%E6%8C%87%E4%BB%A4/" title="花指令"><img src="https://cdn.jsdelivr.net/gh/seeker-fang/Images//202502222116881.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="花指令"/></a><div class="content"><a class="title" href="/2025/07/17/%E8%8A%B1%E6%8C%87%E4%BB%A4/" title="花指令">花指令</a><time datetime="2025-07-17T13:20:38.000Z" title="发表于 2025-07-17 21:20:38">2025-07-17</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(https://cdn.jsdelivr.net/gh/seeker-fang/Images//202502222116882.png);"><div id="footer-wrap"><div class="copyright">&copy;2025 By 第二支羽毛</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.3.3</a></div><div class="footer_custom_text">勇气是开始与结束的一束光</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>